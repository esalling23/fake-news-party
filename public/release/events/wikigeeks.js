var retrievingData,random,playerSubmitted=!1,playerWasReconnected="true"===sessionStorage.getItem("reconnected");"none"!==$(".article-error").css("display")&&setTimeout(function(){$(".article-error").hide()},5e3),$(".body").addClass("wikigeeks");var gameEvents=function(a,b){function c(){$(".form .error").velocity({scale:1.2},{duration:300,loop:1,complete:c},"easeOutElastic",5)}var d,e="https://en.wikipedia.org/w/api.php?callback=?",f=function(a){$(d).find(a).remove()},g=function(a,b,c){if(retrievingData!==!0){var d=e+"&action=parse&format=json&redirects&page="+a;sessionStorage.setItem("currentArticle",a);var f=(String(a),$(".article-name"));f.text(a),retrievingData=!0,$.getJSON(d,function(d){if(d.error){var e="Looks like there's something up with that link/article...<br />Try a different one!";$(".error").html(e).fadeIn();var f=$("#btn_search");return f.find("img").fadeOut(150,function(){f.find("span").fadeIn(150)}),f.removeAttr("disabled"),retrievingData=!1,void loadToggle(!1,!0)}0!==d.parse.redirects.length&&(a=d.parse.redirects[0].to),h(d),c?c&&$("#topic-submission").fadeOut(function(){$("section#submitted").hide(),$("#wiki-article").fadeIn(),$("section#article").show()}):socket.emit("article:select",emitData({title:a,initial:b})),random?$("#article .article-name").html("Our random article generator sent you to<br />"+a):$("#article .article-name").html(a),retrievingData=!1,random=!1,b===!1?$("#article-loading").hide():playerSubmitted=!0})}},h=function(a){var b=a.parse.text["*"];d=$("#wiki-workspace"),$(d).html(b);var c=$(window).width();$("section#article").width(c),$("table").css({"max-width":c,width:"100%","font-size":".9em","word-break":"break-word"}),$("ul.gallery").css({"list-style":"none",padding:"0"}),$(".thumbinner").css({width:"auto","max-width":c-50}),$(".thumbinner img").css({width:"auto","max-width":c-100}),$("img").css({width:"auto","max-width":c-100,margin:"0 auto"}),$(".gallerytext").css("text-align","center"),$("table img").css("display","none"),$("a.image img").css({margin:"0 auto"}),$("table, table.infobox, .thumbinner").css({margin:"0 auto","float":"none"}),$("table:not(:has(table))").css({"margin-top":"5%","margin-bottom":"5%"}),$("table tr:not(:has(tr)), table th:not(:has(th)), table td:not(:has(td))").css({border:"1px solid #36d5d9",padding:"2px"}),$("table.infobox td, .infobox th, .thumbinner").css("padding","1px"),$(".nowraplinks, .nowraplinks tr").css("border","1px solid #36d5d9"),$(".nowraplinks th").css("padding","8px"),$("table.rquote").css("width","100%"),$("table.metadata").css("border","none"),$(".thumb").css({border:"1px solid","background-color":"#e6e6e6",margin:"2%"}),$(".thumbinner").css("padding","2%"),$("div:has(>.wikitable)").css({width:"100%",display:"block"}),f("table.metadata td:has(img)"),f(".mbox-image"),f(".tocnumber"),f(".mw-editsection"),f(".plainlinks.hlist.navbar.mini"),f("span.flagicon"),f(".metadata .image"),f("div#toc"),f(".references"),f("sup"),f(".ambox-Refimprove"),$("li").css("text-align","left"),$("li.gallerybox").css("width","100%"),$("li.gallerybox div:first-child").css("width","100%"),$("span#See_also").parent().nextAll().remove(),$("span#See_also").parent().remove(),$("#wiki-content").html($(d).clone().html()).find("a").click(function(a){a.preventDefault();var b=$(a.currentTarget).data().title;g(b,!1),loadToggle(!0,!0)}).each(function(a,b){$(b).data({title:$(b).attr("href").replace("/wiki/","")}),$(b).hasClass("new")&&$(b).attr("href","javascript:void(0)").attr("disabled","disabled")}),window.scrollTo(0,0),$(d).empty(),loadToggle(!1,!0)};switch($("#btn_ok").on("click",function(){$("#time-up").hide()}),a){case"game:start":updateGameContent(b,function(){sessionStorage.currentArticle&&playerWasReconnected&&g(sessionStorage.currentArticle,!1,!0);var a=$("#article_input");-1!==location.href.indexOf("debug")&&$.getJSON(e+"&action=query&format=json&list=random&rnnamespace=0&rnfilterredir=nonredirects&rnlimit=1",function(b){a.val(b.query.random[0].title)}),$("button#clear").click(function(){a.val(""),$(this).addClass("hidden"),$(".submission .form").removeClass("moveUp")}),$("#btn_search").click(function(b){var c=$(b.currentTarget);c.find("span").fadeOut(150,function(){c.find("img").fadeIn(150,function(){g(a.val(),!0)})}),c.attr("disabled","disabled")}),a.autocomplete({source:function(a,b){$.ajax({url:"https://en.wikipedia.org/w/api.php",dataType:"jsonp",data:{action:"opensearch",format:"json",search:a.term},success:function(a){b(a[1])}})},select:function(a,b){$("button#clear").removeClass("hidden"),$(".submission .form").addClass("moveUp")}}),a.keypress(function(a){$(a.currentTarget).removeClass("invalid"),$(".error").fadeOut(250)})});break;case"article:tryagain":$("#btn_search img").hide(),$("#btn_search span").show(),$(".error").text(b).fadeIn(),$("input").disabled=!1,$("#btn_search").attr("disabled",!1),playerSubmitted=!1,loadToggle(!1);break;case"article:valid":b.initial&&($("#topic-submission").fadeOut(function(){$("section#submitted").fadeIn(),$("#wiki-article").fadeIn()}),playerSubmitted=!0);break;case"article:random":random=!0,g(b,!1,!0),playerSubmitted=!1;break;case"wiki:results":updateGameContent(b);var i=500,j=0,k=$("#firstArticle"),l=$(".articleGroup");$(k).css({transform:"scale(1)"}),$.each(l,function(a,b){var c=$(b).find(".articleDot"),d=$(b).find(".articleLine"),e=$(b).find(".articleText"),f=i+j;$(c[0]).delay(f).velocity({r:10},i,[50,10]),$(d).delay(500+f).velocity({y2:50},i,[50,10]),$(c[1]).delay(1e3+f).velocity({r:10},i,[50,10]),setTimeout(function(){$(e).css({transform:"scale(1)"})},1500+f),j=5*i*a,$("#survey-ready").click(function(){$(".results-container").fadeOut(),$(".typeform").fadeIn()})});break;case"topic:info":$(".timesUp").hide(),$("input").disabled=!1;var m=function(){"none"!==$("section#submitted").css("display")?$("section#submitted").hide():clearInterval(n)};$("#wiki-article").show(),$("section#article").show(),$("section#submitted").hide();var n=setInterval(function(){m()},1e3);break;case"game:countdown_ending":void 0!==sessionStorage.currentArticle&&playerWasReconnected&&socket.emit("game:start",{gameId:sessionStorage.gameCode}),playerSubmitted===!1&&($(".form .error").text(b+"If you haven't found a starting article soon, we will choose one for you.."),c());break;case"game:countdown_end":$("input").disabled=!1,$(".form .error").hide(),"results"===b&&$("#time-up").show(),"topicCountdown"===b&&(playerSubmitted===!1?($("input").disabled=!0,$("#topic-submission").hide(),$(".timesUp").html("<span>Time is up! Sending you to a random article...</span>"),$(".timesUp").show()):($("input").disabled=!0,$("section#submitted").hide(),$(".timesUp").html("<span>Time is up! Sending you to your starting article...</span>"),$(".timesUp").show()))}};