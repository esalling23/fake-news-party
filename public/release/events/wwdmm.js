var playerWasReconnected="true"===sessionStorage.getItem("reconnected"),imageLoaded=function(a,b){a.find("img").first().on("load",function(){b()}).each(function(){this.complete&&$(this).load()})};$(".body").addClass("wwdmm");var gameEvents=function(a,b){switch(a){case"game:start":updateGameContent(b.html),$(".header").fadeIn();break;case"meme:create":var c,d=0;updateGameContent(b,function(){imageLoaded($("#meme-slider"),function(){$("#meme-slider").glide({type:"carousel",autoplay:!1,autoheight:!0,afterTransition:function(a){d=a.index-1,$("#image-index").val(d)}})});var a=new Kinetic.Stage({container:"meme-canvas",width:400,height:400}),b=new Kinetic.Layer;a.add(b);var e=new Kinetic.Text({name:"upper",x:0,y:40,text:"",fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:400,align:"center"}),f=new Kinetic.Text({name:"lower",x:0,y:400,text:"",fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:400,align:"center"}),g=function(c){var d="text-upper"===c.attr("id")?e:f;d.setText(c.val().toUpperCase()),d.fontSize(getFontSize(c.val())),f.setY(a.getHeight()-f.getHeight()-40),b.draw()};$("#btn-next input").click(function(d){var g=$(".glide__slide.active img")[0];c?c.setImage(g):(c=new Kinetic.Image({x:0,y:0,width:a.getWidth(),height:a.getHeight(),image:g}),b.add(c),b.add(e),b.add(f)),b.draw(),$("#btn-next").hide(),$("#meme-slider").hide(),$("#meme-text").show(),$("#btns-submit").show()}),$("#btn-back").click(function(a){$("#meme-slider").show(),$("#meme-text").hide(),$("#btn-next").show(),$("#btns-submit").hide()}),$(".meme-text").keydown(function(a){g($(a.currentTarget))})});break;case"meme:tryagain":$(".error").text(b).fadeIn(),$("#btn-submit").removeAttr("disabled"),loadToggle(!1,!0);break;case"meme:received":$("#meme-create").fadeOut(function(){$("#meme-created").fadeIn()}),sessionStorage.setItem("playerSubmission",b),loadToggle(!1);break;case"meme:voting":var d=0;updateGameContent(b,function(){$("#meme-slider").find('li.glide__slide[data-id="'+sessionStorage.getItem("playerSubmission")+'"]').remove(),$("#meme-slider").glide({type:"carousel",autoplay:!1,afterTransition:function(a){d=a.index-1}}),$.each($(".meme-canvas"),function(a,b){var c=$(b).data().upper?$(b).data().upper.toUpperCase():"",d=$(b).data().lower?$(b).data().lower.toUpperCase():"",e=new Kinetic.Stage({container:$(b)[0],width:400,height:400}),f=new Kinetic.Layer,g=new Kinetic.Text({name:"upper",x:0,y:20,text:c,fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:400,align:"center"}),h=new Kinetic.Text({name:"lower",x:0,y:150,text:d,fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:400,align:"center"}),i=new Image;i.onload=function(){var a=new Kinetic.Image({x:0,y:0,width:e.getWidth(),height:e.getHeight(),image:i});f.add(a),f.add(g),f.add(h),g.fontSize(getFontSize(c)),h.fontSize(getFontSize(d)),h.setY(e.getHeight()-h.getHeight()-40),e.add(f),f.draw()},i.src=$(b).data().img}),$("#btn-vote").click(function(a){socket.emit("meme:vote",emitData(d)),$(a.currentTarget).val("voted!").attr("disabled",!0).css({opacity:"0.3"})}),$(".btn-like").click(function(a){socket.emit("meme:like",emitData(d)),$(a.currentTarget).attr("disabled",!0).css("opacity","0.3"),TweenLite.to($(a.currentTarget),.5,{scale:.7,ease:Bounce.easeOut})})})}};