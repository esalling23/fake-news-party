"use strict";var clockInterval,resultsAnimSlider,header=$("#top-header"),topBar=header.detach();topBar.prependTo("body");var lobbyAnim=new TimelineLite;lobbyAnim.fromTo(header,1,{y:"-100%"},{y:"-10%",autoAlpha:1,ease:Elastic.easeOut,delay:.5}).add("header").from($(".room-container"),1,{y:"-200%",autoAlpha:0,ease:Elastic.easeOut},"header+=.5").from($(".players-left"),1.25,{x:600,autoAlpha:0,ease:Elastic.easeOut},"header+=1").from($(".players-right"),1.25,{x:-600,autoAlpha:0,ease:Elastic.easeOut},"header+=1");var loadMemes=function(){$.each($(".meme-canvas"),function(a,b){var c=$(b).data().upper?$(b).data().upper:"",d=$(b).data().lower?$(b).data().lower:"",e=$(b).data().dimension,f=new Kinetic.Stage({container:$(b)[0],width:e,height:e}),g=new Kinetic.Layer,h=new Kinetic.Text({name:"upper",x:0,y:20,text:c.toUpperCase(),fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:e,align:"center"}),i=new Kinetic.Text({name:"lower",x:0,y:150,text:d.toUpperCase(),fontSize:46,fontFamily:'Impact, "Impact-External"',fill:"#fff",stroke:"#000",strokeWidth:2,lineJoin:"round",width:e,align:"center"}),j=new Image;j.onload=function(){var a=new Kinetic.Image({x:0,y:0,width:f.getWidth(),height:f.getHeight(),image:j});g.add(a),g.add(h),g.add(i),h.fontSize(.8*getFontSize(c)),i.fontSize(.8*getFontSize(d)),i.setY(f.getHeight()-i.getHeight()-20),f.add(g),g.draw()},j.src=$(b).data().img})},gameEvents=function(a,b){function c(){$("#submissions").fadeOut(500).remove();var a=new TimelineLite({onComplete:function(){d()}});a.from($("#scores"),1,{autoAlpha:0}).add("scores").to($("#scores"),1,{autoAlpha:0,scale:0,display:"none",ease:Bounce.easeOut},"scores+=4")}function d(){var a=new TimelineLite({onComplete:function(){e()}});a.to($("#round-header"),.5,{autoAlpha:0,y:"0%",display:"none"}).add("header").fromTo($("#leaderboard-header"),.5,{autoAlpha:0,y:"50%"},{autoAlpha:1,y:"0%",display:"block"},"header+=.6").from($("#leaderboard"),1,{autoAlpha:0}).add("leaderboard").to($("#leaderboard"),1,{autoAlpha:0,scale:0,display:"none",ease:Bounce.easeOut},"leaderboard+=4")}function e(){var a=new TimelineLite;if($("#next-round")[0])a.to($("#leaderboard-header"),.5,{autoAlpha:0,y:"50%",display:"none"}).add("header").fromTo($("#next-round-header"),.5,{autoAlpha:0,y:"50%"},{autoAlpha:1,y:"0%",display:"block"},"header+=.6"),TweenLite.from($("#next-round, #game-ended"),1,{autoAlpha:0,scale:0});else{var b=10;a.to($("#leaderboard-header"),.5,{autoAlpha:0,y:"0%",display:"none"}).add("header").fromTo($("#winners-header"),.5,{autoAlpha:0,y:"50%"},{autoAlpha:1,y:"0%",display:"block"},"header+=.6").from($("#winners-circle"),1,{autoAlpha:0}),setInterval(function(){b--,0==b&&(location.href="\\")},1e3)}}switch(a){case"game:countdown":clockInterval&&clearInterval(clockInterval);var f=b.duration,g=$(".countdown #countdown");clockInterval=setInterval(function(){0===g.length&&(g=$(".countdown #countdown")),f--;var a=secondsToHms(f);$(g).html(a),0===f&&clearInterval(clockInterval)},1e3);break;case"meme:topic":updateGameContent(b);break;case"meme:voting":updateGameContent(b,function(){loadMemes()});break;case"meme:results":updateGameContent(b,function(){loadMemes()});var h=new TimelineLite({onComplete:function(){c()}});h.from($("#submissions"),1,{autoAlpha:0}).add("submissions");var i=$("#submissions .submission");_.each(i,function(a,b){h.from(a,1,{y:0,scale:0,autoAlpha:0,ease:Ease.easeOut},"+=.5").from($(a).find(".meme"),1,{y:100,scale:0,autoAlpha:0,ease:Ease.easeOut},"+=.5").from($(a).find(".votes-box"),.5,{y:100,scale:0,autoAlpha:0,ease:Ease.easeOut},"+=.5").staggerFrom($(a).find(".votes-box .vote"),.3,{scale:0,autoAlpha:0,ease:Bounce.easeOut},.3,"+=.4").staggerFrom($(a).find(".votes-box .vote .score"),1,{scale:0,autoAlpha:0,rotation:360,ease:Elastic.easeOut},1,"+=.4").from($(a).find(".name.submitter"),1,{y:100,scale:0,autoAlpha:0,ease:Ease.easeOut},"+=2").from($(a).find(".likes-box"),.5,{y:100,scale:0,autoAlpha:0,ease:Ease.easeOut},"+=.5").staggerFrom($(a).find(".likes-box .vote"),.3,{scale:0,autoAlpha:0,ease:Bounce.easeOut},.3,"+=.4").staggerFrom($(a).find(".likes-box .vote .score"),1,{scale:0,autoAlpha:0,rotation:-180,ease:Elastic.easeOut},1,"+=.4").to(a,1,{y:0,scale:0,autoAlpha:0,display:"none",ease:Ease.easeIn},"+=4")}),$("#slider-gsap").length&&(resultsAnimSlider=new GSAPTLSlider(h,"slider-gsap",{width:600}))}};