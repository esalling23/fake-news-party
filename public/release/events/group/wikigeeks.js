var clockInterval,wikiAnimSlider,openAnim=new TimelineLite;openAnim.from($(".room-container"),1,{scale:0,autoAlpha:0,delay:1,ease:Elastic.easeOut}).staggerFrom($(".players.left .player-background"),2,{xPercent:-200,force3D:!0,autoAlpha:0,ease:Elastic.easeOut},.1).staggerFrom($(".players.right .player-background"),2,{xPercent:200,force3D:!0,autoAlpha:0,ease:Elastic.easeOut},.1);var gameEvents=function(a,b){function c(){$("#results, #results-header").show(),n.fromTo($("#results-header"),1,{autoAlpha:0,delay:0},{autoAlpha:1}).add("resultsShow").from($("#results"),1,{autoAlpha:0,scale:0,ease:Bounce.easeOut,delay:0},"resultsShow+=1").staggerFromTo($("#results .user"),1,{autoAlpha:0,scale:1,y:250},{autoAlpha:1,scale:1,y:0,ease:Bounce.easeOut},.5,"resultsShow+=3").to($("#results"),1,{autoAlpha:0,scale:0,display:"none",ease:Bounce.easeOut},"resultsShow+=9").add("scoringShow").add(function(){$("#scoring").show()}).from($("#scoring"),1,{autoAlpha:0,scale:0,ease:Bounce.easeOut},"scoringShow+=1").staggerFromTo($("#scoring .user"),1,{autoAlpha:0,scale:1,y:250},{autoAlpha:1,scale:1,y:0,ease:Bounce.easeOut},.5,"scoringShow+=3").to($("#scoring"),1,{autoAlpha:0,scale:0,display:"none",ease:Bounce.easeOut},"scoringShow+=7").add("leadersShow").add(function(){$("#leaderboard, #count").show()}).from($("#leaderboard"),1,{autoAlpha:0,scale:0,ease:Bounce.easeOut},"leadersShow+=1").staggerFromTo($("#leaderboard .user"),1,{autoAlpha:0,scale:1,y:250},{autoAlpha:1,scale:1,y:0,ease:Bounce.easeOut},.5,"leadersShow+=3").from($("#countdown"),1,{autoAlpha:0,ease:Bounce.easeOut},"leadersShow+=7"),$("#slider-gsap").length&&(wikiAnimSlider=new GSAPTLSlider(n,"slider-gsap",{width:600})),n.play()}switch(a){case"game:countdown":var d=$(".countdown"),e=$("#countdown #text"),f=$("#article-reveal #countdown #text"),g=b.duration,h=b.name;clockInterval&&clearInterval(clockInterval),clockInterval=setInterval(function(){g--;var a=secondsToHms(g);if($(e).html(a),$(f).html(a),"hidden"===d.css("visibility")&&TweenLite.from(d,.5,{autoAlpha:0,scale:.5,ease:Elastic.easeOut}),0==g&&"topicCountdown"===h&&clearInterval(clockInterval),0==g&&"articleReveal"===h)clearInterval(clockInterval);else if(5==g&&"topicCountdown"===h){var b=$("#article-reveal");d.fadeOut(300),b.fadeIn(500,function(){TweenLite.from($(b).find("#content"),.5,{autoAlpha:0,scale:.5,ease:Elastic.easeOut})});var c=new ProgressBar.Circle("#article-reveal #countdown",{color:"#fff",duration:1e3*g,easing:"easeInOut",strokeWidth:6,trailColor:"#f4f4f4",trailWidth:.8,fill:"#00c5c2",from:{color:"#00c5c2",width:1},to:{color:"#fff",width:4},step:function(a,b){b.path.setAttribute("stroke",a.color),b.path.setAttribute("stroke-width",a.width),b.setText(g)}});c.animate(1)}},1e3);break;case"topic:info":$("#gameContent").html(b.html),$("#reveal").html(b.reveal),$("#overlay").fadeOut().empty(),$("#goto_results").hide();var i=$(".player-static"),j=i[b.index],k=name.length<=15?name:name.substring(0,15)+"...";$(j).children(".icon").addClass("active"),$(j).children(".nameplate").addClass("active").text(k);break;case"player:finished":var i=$(".player-static"),j=i[b.index],k=name.length<=15?name:name.substring(0,15)+"...";$(j).children(".icon").addClass("active"),$(j).children(".nameplate").addClass("active").text(k);break;case"wiki:waiting":$(".countdown #countdown").fadeOut(500,function(){$(".countdown #out-of-time").fadeIn(500)}),$("#goto_results").show();break;case"wiki:click":var i=(new TimelineLite({paused:!0}),$(".player-static")),l=i[b.index];$(l).velocity({scale:1.25},{duration:300},"easeInElastic",5).velocity({scale:1},{duration:300},5);break;case"wiki:results":updateGameContent(b),clearInterval(clockInterval);var m=new TimelineLite({paused:!0,onComplete:function(){c()}}),n=new TimelineLite({paused:!0}),o=$("#top-players .player-path");_.each(o,function(a,b){var c=$(a).find(".title"),d=$(a).find(".articleDot"),e=$(a).find(".articleLine"),f=c.size();m.from($(a),2,{autoAlpha:0,scale:0,ease:Bounce.easeOut,delay:1}),$("g.last").velocity({opacity:0},0),_.each(c,function(a,b){m.from($(a),.5,{autoAlpha:0,scale:0,ease:Bounce.easeOut,delay:1,onStart:function(){var a=$(e[b]);if($(d[b]).velocity({r:8},500,[50,10]),a.velocity({x2:a.data().x2,y2:a.data().y2},1e3,[50,10]),b===f-2){var c=$("g.last").find(".destination");$("g.last").velocity({opacity:1},{duration:500,delay:15}),$.each(c,function(a,b){$(b).velocity({"stroke-dashoffset":400},0).velocity({"stroke-dashoffset":0},{duration:500,delay:5})})}}})}),m.to($(a),1,{autoAlpha:0,scale:0,display:"none",ease:Bounce.easeOut,delay:5})}),m.play();break;case"game:countdown_end":}};